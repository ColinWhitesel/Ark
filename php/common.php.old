<?php
/*
  CS 270 - Group Project
  ARK (Animal Record Keeper)
  Trevor D. Brown, Jamie Thomas, Colin Whitesel, and Brian Bulka

  common.php - common functions for all php pages of the project.
*/

 // PDOCall($SQLStatement) - offers a convenient way for PDO calls to be made to the database
 function PDOCall($SQLStatement){
   // Prepare PDO
   // MySQL Connection Information
   $host = 'localhost';
   $username = 'root';
   $password = 'C0mputing2!';

   // Use Database SQL
   $UseDatabaseSQL = "USE ark";

   // Prepare variable that will be returned.
   $response_data = [];

   if (strpos($SQLStatement, 'SELECT') !== false){
     $response_data = SelectSQL($host, $username, $password, $UseDatabaseSQL, $SQLStatement);
   }
   else{
      InsertUpdateSQL($host, $username, $password, $UseDatabaseSQL, $SQLStatement);
      $response_data = "Insert Called!";
   }

   return $response_data;
 }

 function InsertUpdateSQL($server, $username, $password, $UseDatabaseSQL, $SQLStatement){
   $connection = null;

   // Attempt to create a PDO to interact with the DBMS
   try{
     $connection = new PDO("mysql:host=$server;", $username, $password);
     $connection -> setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

     $connection -> exec($UseDatabaseSQL);
     $query = $connection -> prepare($SQLStatement);
     $query -> execute();

   }
   catch (PDOException $e){
     // If PDO fails, throw error.
     echo $SQLStatement . "<br />" . $e -> getMessage();
   }

   // Clear the connection, using "null"
   $connection = null;
 }

 function SelectSQL($server, $username, $password, $UseDatabaseSQL, $SQLStatement){
   // Create the connection variable
   $conn = null;

   // Prepare variable that will be returned.
   $sqlResults = [];

   // Attempt to create a PDO to interact with the DBMS
   try{
     $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
     $conn -> setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

     //$conn -> exec();

     $stmt = $conn -> prepare($sql);
     $stmt -> execute();

     $sqlResults = $stmt->fetchAll(\PDO::FETCH_ASSOC);
   }
   catch (PDOException $e){
     // If PDO fails, throw error.
     echo $sql . "<br />" . $e -> getMessage();
   }

   // Clear the connection, using "null"
   $conn = null;

   return $sqlResults;

 }

 // SendJSON($data) - provides a convenient way for JSON responses to be sent to the frontend.
 function SendJSON($data){
   // Send the data back to frontend, via JSON.
   header('Content-Type: application/json');
   echo json_encode($data);
 }

?>
